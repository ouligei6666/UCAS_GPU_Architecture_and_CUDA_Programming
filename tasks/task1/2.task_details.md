如果想直接上手可以看文件


------
# 以下是大作业一评分系统页面的详细信息(http://124.16.71.53:50001/ 需要用UCAS校园网登录)


## 欢迎来到2025《GPU架构与编程》大作业一评测系统
首次使用时，请在“获取验证码”页面填写您的个人信息。验证码将发送至您的邮箱，并作为后续提交的唯一凭证，请妥善保管。若想使用真实姓名，请将昵称和姓名填成一样的。

使用本系统时遇到任何问题，都可在第一时间联系龚昊助教（优先在群里@，私人问题可私信），会尽快处理。目前10月20日16点06分前申请旁听的同学都可以使用本系统。


## 计算机学院的服务器信息（用于大作业一的调试，也可选用各家提供的算力）：
（网址端口和密码都已经混淆，避免风险）
IP：124.xx.xx.7
端口号：7xx2
用户名：course
密码：couxxxxx!**xx!
使用Xshell等SSH客户端访问，仅限使用校园网访问，可使用adduser命令创建自己的独立账号，不可用于与课程无关的深度学习训练以及挖矿等违规行为。

这个服务器的任何问题请@龚昊助教处理。

## （规则明确）
10月23日更新的重要通知： 为确保实现结果符合纯脉冲神经网络（Spiking Neural Network, SNN）的拓扑特性，网络结构及信号传递需满足以下约束条件：

- 每个时间步的输出仅由脉冲发放驱动，不得包含任何连续调制或模拟信号成分。
各层之间（例如从 IFNode 到 MaxPool，或从 MaxPool 到 Conv）传递的信号必须为脉冲信号。
- 除最终输出层外，所有层间传递的特征图均应为二值化脉冲（例如 0.0 表示未发放，1.0 表示发放）。
- IFNode 的输出张量中每个元素在任意时间步上只能取二元值（0 或 1），不得出现连续幅值或概率形式的发放结果。
- MaxPool 层必须作用于二值化脉冲特征图，而非连续值特征图。
- 网络任意层的输出均不得由脉冲信号与连续信号混合形成（包括但不限于脉冲与模拟信号的加权、叠加或拼接）。
- 对于直接使用提供的网络结构与权重的实现，上述约束条件默认满足，无需额外修改。

基本上，可以修改的参数只有conv2d、maxpool2d和linear的维度以及T还有训练过程中的各种细节（包括优化器等），其它所有改动都需要和助教核实。

另外，使用自己训练权重的同学，禁止将测试集混入训练集进行训练，为了堵住这个漏洞，后台会不定时检测所有上传的压缩包的MD5，如果和助教上传的MD5不一致的，必须补充带有seed的训练程序（如果不带seed则以助教随便训练一遍的结果为准），训练程序的执行格式必须为python train.py，且必须严格输出十个和上传规则一致的同名的文件，且程序执行时间不能超过两个小时，如果引入了奇奇怪怪的包或者程序报错直接取消成绩。助教将会不定时将所有MD5不一致的提交的训练程序全部跑一遍（只核对上榜的那次提交），用助教跑的训练程序输出的权重作为推理程序所加载的程序重新测试，如果准确率小于0.8978将被取消成绩，只能重新提交。

10月22日更新的重要通知：我们允许对给定的 SCNN 模型进行一定程度的“微调”，但之前的说明文字没有把微调的程度说清楚，导致有部分同学的提交对网络进行了过度简化。所有提交自定义权重的同学，其模型和训练过程必须严格遵守以下规范，如果有同学自查发现提交的程序违反了这些规定的，可以联系助教撤销成绩然后重新提交，助教会持续核查大家的提交，确保大作业一环境规则清晰且公平。如果有任何因本条规则明确而造成不便的，请同学们谅解：

- 结构拓扑恒定:
禁止改变层数与顺序：必须保持` Conv -> IF -> Pool -> Conv -> IF -> Pool -> Flatten -> FC -> IF -> FC -> IF -> FC `的 11 层网络拓扑结构。不得增加、删除或重排任何层。
- 层类型恒定:
禁止改变层的根本类型：Conv2d 必须是标准的密集卷积，MaxPool2d 必须是最大池化，Linear 必须是全连接层。严禁替换为 Depthwise Convolution、AvgPool2d 等其他类型。
- SNN 本质恒定:
禁止将模型退化为静态网络：IFNode 必须被实现为一个随时间演化的脉冲神经元。时间步长 T 必须大于等于 2 (T >= 2)。T=1 会使模型失去时间动态性，等同于一个普通 ANN，因此被禁止。你必须完整实现膜电位（membrane potential）在 T 个时间步内的累积与重置逻辑。
- 允许修改 SNN 时间步长 T:
你可以将 T 设置为 2 到 8 之间的任意整数 (T ∈ [2, 8])。
- 允许减少或增加层的“宽度”:
你可以减少或增加卷积层的输出通道数和全连接层的输出神经元数量,确保修改之后相邻层之间是兼容的。
- 允许调整卷积/池化核的基础参数:
- 你可以修改卷积核的 kernel_size、stride、padding，以及池化层的 kernel_size、stride。

## 环境变量设置

有同学在使用计算机学院服务器adduser之后发现没有nvcc命令，可以配一下环境变量到自己用户的`~/.bashrc`里面然后重启终端：
```shell
export CUDA_HOME=/usr/local/cuda
export PATH=$PATH:$CUDA_HOME/bin
export LD_LIBRARY_PATH=/usr/local/cuda/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
```
这样操作之后，nvcc命令就可以正常使用了，大家在使用的服务器的时候尽量避免使用course账户的sudo权限执行adduser以外的命令

虽然同学们不用跑训练程序，但是CUDA C/C++推理程序的推理过程必须和训练程序的推理过程完全吻合才能正确使用和加载训练程序导出的权重，训练程序中的网络结构实现是本大作业的唯一模板范例。

## 提交说明：
在“提交代码”页面，您需要提交两份文件（这两份文件中压缩包已经直接给出来了，可以直接交；推理程序文件是模板，需要完成后提交，直接交会浪费一次提交次数，且不计入成绩）：

权重文件压缩包 (.zip): 一个包含10个权重/偏置文件的zip压缩包。（压缩时不能包含文件夹，请选中这10个文件后直接进行压缩）这10个文件必须被准确命名为：
`conv1.weight.txt`, `conv1.bias.txt`
`conv2.weight.txt`, `conv2.bias.txt`
`fc1.weight.txt`, `fc1.bias.txt`
`fc2.weight.txt`, `fc2.bias.txt`
`fc3.weight.txt`, `fc3.bias.txt`

推理程序文件 (.cu): 一个CUDA C/C++源文件，用于加载上述权重并执行推理。
如果您在代码中使用了PTX JIT编译等技术，请勾选上“是否使用PTX编程”复选框，将获得课程加分，但是请注意，评测系统只会记录推理时间最短的那次提交，如果不使用PTX编程的提交比使用PTX编程的提交的耗时还短，成绩将被覆盖且无法获得加分！请确保代码确实使用了PTX编程技术之后再勾上复选框，否则会取消成绩。

##  排名规则：
只有准确率大于等于 0.8978 的提交才会被计入有效排名，准确率不达标的提交是无效的。在满足此条件下，将按照 推理总时间 从低到高进行排名。排行榜可以按校区进行筛选。每个人最多有100次提交机会！每个程序运行的时间最多1分钟，超过1分钟会被杀掉。提交成功后，请耐心等待，所有同学的程序都将按照提交的先后顺序排队串行执行，程序执行结果将会通过邮件告知。

## 输出格式要求：
您的推理程序(`.cu`)中所有标记在
```c++
// ===================================================================================
// XXX - DO NOT MODIFY BEGIN
// ===================================================================================

// ===================================================================================
// XXX - DO NOT MODIFY END
// ===================================================================================
```
之间的代码段都不允许进行任何修改！每一次的提交的全部内容都会保存用于审计，任何访问网络或系统调用、替桩计时函数、恶意系统破坏、硬编码推理标签结果、篡改推理程序标记区域、使用库函数直接完成运算等一切违规行为都是不允许的。鼓励大家使用豆包、Deepseek等大模型工具完成作业！借助这些工具完成一份能够有效获得课程分数的作业是完全没问题的，已经帮大家测试过了！大作业一的成绩取决于排名，大作业一的排名不用于评奖只用来获得课程成绩。

## 测评服务器编译与环境：
评测服务器CUDA版本为11.8，编译命令为：
`nvcc inference.cu -o inference_prog -Xcompiler "-O3 -std=c++14" -gencode arch=compute_60,code=sm_60 -gencode arch=compute_61,code=sm_61 -gencode arch=compute_70,code=sm_70 -rdc=true
评测将在单块Tesla V100S-PCIE-32GB上进行。`
(commit by ouligei：这个编译命令和你测试过程中用的不一样不要自己编写调试的时候运行)

## 训练程序：
为了提高作业的竞争上限，我们提供训练程序（训练程序可以直接导出权重，并且可以被推理程序模板直接加载使用）以及助教训练好的权重(其准确率正好是0.8978)，你可以直接使用助教训练的权重，也可以自己训练新的权重，还可以微调网络结构，但是模型的基本结构和层数不能有变化，任何改变模型层数，卷积类型的操作都是不允许的，且必须保证导出10个固定名称的权重文件
训练程序的环境配置：(commit by ouligei：不要再国科大服务器里配置已经有了，这是给自己服务器上设置conda环境的命令)
```shell
conda create -n cuda-cnn-tester-2025 python=3.12
pip install torch==2.6.0 torchvision==0.21.0 torchaudio==2.6.0 --index-url https://download.pytorch.org/whl/cu118
pip install spikingjelly
```
至于conda和pip命令的使用以及深度神经网络模型训练相关内容，感兴趣的同学可自行查阅相关学习资料，若不想进行这些方面的激进的提升，则直接使用助教提供的训练好的推理权重即可

（以下文件,我将文件本体或便捷下载方式放到了needed_files中，你也可以自己下载）

https://paste.ubuntu.com/p/qj2HRzd7Jn/ 下载Python训练程序

https://www.123865.com/s/A5fDVv-Z2i3A 下载可以直接用于提交的助教训练好的推理权重压缩包，可以直接浏览器下载

https://www.worldlink.com.cn/en/osdir/fashion-mnist.html 下载数据集用于本地调试

## 推理程序模板：
这个推理程序模板中标记区域外的内容可以随便增删改，它可以在编译不出错的情况下直接通过评测系统的提交，但是会浪费一次提交次数
https://paste.ubuntu.com/p/PPzYN4hJ4b/ 下载CUDA C/C++推理程序模板